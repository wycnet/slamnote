
# 第五讲:相机与图像

## 相机模型

我们使用`针孔模型`和镜头`畸变`来描述投影过程.

### 针孔相机模型

利用小孔成像原理将三维世界投影到二维平面中.

现在对针孔模型进行简单建模:

- $Oxyz$ 坐标系
- $z$轴指向相机前方
- $x$右方
- $y$下方
- 现实世界的空间点$p$
- 小孔为坐标中心$O$
- $p$的投影点在平面$O^\prime-x^\prime-y^\prime$上.
- 成像点为$p^\prime$
- p的坐标为$[X,Y,Z]^T$, $p^\prime$为$[X^\prime,Y^\prime,Z^\prime]^T$
- 物理成像平面到小孔的距离为$f$

根据三角相似的关系:

$$
\frac{Z}{f} = - \frac{X}{X^\prime} = - \frac{Y}{Y^\prime}
$$

为了简化,我们将物体和成像都放在相机的同侧,这样可以简化掉负号:
$$
\frac{Z}{f} = \frac{X}{X^\prime} = \frac{Y}{Y^\prime}
$$

整理得:
$$
\begin{cases}
	X^\prime = f\frac{X}{Z} \\
	Y^\prime = f\frac{Y}{Z}
\end{cases}
$$

尽管现实中小孔成像是倒立的,但是我们人为将其置为正立.

在物理成像平面固定着一个像素平面:$o-u-v$, 在像素平面得到的$P^\prime$的坐标为:$[u,v]^T$

`像素坐标系`: 远点$o^\prime$位于图像的左上角,u 轴向右与x轴平行, v轴向下与y轴平行.

像素坐标系与成像平面之间相差了一个`缩放`与`原点平移`.

假设像素坐标: 

- 在$u$轴缩放了$\alpha$倍
- 在$v$轴缩放了$\beta$倍
- 原点平移了$[c_x,c_y]^T$

$P^\prime$坐标与像素坐标$[u,v]^T$之间的关系为:

$$
\begin{cases}
	u=\alpha X^\prime +c_x \\
	v=\beta Y^\prime +c_y
\end{cases}
$$

根据:$X^\prime = f\frac{X}{Z} ;\quad Y^\prime = f\frac{Y}{Z}$,可得:
$$
\begin{cases}
	u=\alpha f\frac{X}{Z} +c_x \\
	v=\beta f\frac{Y}{Z} +c_y
\end{cases}
$$

令$\alpha f= f_x; \quad \beta f=f_y$,得:
$$
\begin{cases}
	u=f_x\frac{X}{Z} +c_x \\
	v=f_y\frac{Y}{Z} +c_y
\end{cases}
$$

将其化为矩阵形式:
$$
\begin{bmatrix}
	u\\v\\1
\end{bmatrix} =
\frac{1}{Z}
\begin{bmatrix}
	f_x & 0 & c_x \\
	0 & f_y & c_y \\
	0 & 0 & 1
\end{bmatrix} 
\begin{bmatrix}
	X \\ Y \\ Z
\end{bmatrix}
\triangleq \frac{1}{Z}KP
$$

将Z移动到左边:
$$
Z
\begin{bmatrix}
	u\\v\\1
\end{bmatrix} =
\begin{bmatrix}
	f_x & 0 & c_x \\
	0 & f_y & c_y \\
	0 & 0 & 1
\end{bmatrix} 
\begin{bmatrix}
	X \\ Y \\ Z
\end{bmatrix}
\triangleq KP
$$

将$K$称为`内参矩阵`.

$P$的世界坐标到像素坐标的投影关系:
$$
ZP_{uv}=Z\begin{bmatrix}
	u\\v\\1
\end{bmatrix} = K(RP_w +t) = KTP_w
$$

上式两端都是齐次坐标. 所以可以将Z去掉:

$$
P_{uv} = KTP_w
$$

右侧的$TP_w$表示把世界坐标系下的齐次坐标变换到相机坐标系下.为了使它能够与K相乘, 取它的前三维组成三维向量.
然后按照齐次坐标的方式将其归一化处理:

假设:
$$
(TP_w)_{(1:3)} = \begin{bmatrix}
	X \\ Y \\ Z
\end{bmatrix} = \tilde{P}_c
$$
归一化:
$$
P_c = \begin{bmatrix}
	X/Z \\ Y/Z \\ 1
\end{bmatrix}
$$

所以我们可以把像素坐标$[u,v]^T$ 看成是对归一化平面的点进行量化的过程.

### 畸变

由透镜引起的畸变称为`径向畸变`.主要分为两类:`桶形畸变`和`枕形畸变`.

在畸变中穿过图像中心和光轴有焦点的直线还能保持形状不变.

在相机的 组装过程中由于透镜和成像面不能严格的平行会产生`切向畸变`.

