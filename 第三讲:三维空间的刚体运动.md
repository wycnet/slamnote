# 三维空间的刚体运动

本讲主要介绍 **一个刚体在三维空间中如何运动的.**

## 旋转矩阵

### 点和向量,坐标系

三维空间的刚体要考虑 **位置** 和  **姿态** . 

向量内积:

$$
\vec{a} \cdot \vec{b} = \vec{a} ^T \vec{b} = \sum_{i=1}^3a_ib_i = |\vec{a}||\vec{b}| \cos \langle \vec{a}, \vec{b} \rangle
$$

向量外积:

$$
\vec{a} \times \vec{b} = 
\begin{Vmatrix}
	\vec{i} & \vec{j} & \vec{k} \\
	a_1 & a_2 & a_3 \\
	b_1 & b_2 & b_3
\end{Vmatrix}=
\begin{bmatrix}
	a_2b_3-a_3b_3  \\
	a_1b_3-a_3b_1 \\
	a_1b_2-a_2b_1
\end{bmatrix}=
\begin{bmatrix}
	0 & -a_3 & a_2 \\
	a_3 & 0 & -a_1 \\
	-a_2 & a_1 & 0 
\end{bmatrix}
\vec{b}
$$


> 反对称矩阵 $A_T = - A$ , 在本书中将定义反对称矩阵为: a的反对称矩阵为 a^

### 坐标系间的欧式变换

对于同一个向量 $\vec{p}$, 它在世界坐标系和相机坐标系下的坐标是不同的. 在两个坐标系下的转变我们用转换矩阵$T$来表示

一个欧式变换由 **旋转** 和 **平移** 两部分组成.

1. 旋转:

	假设某个单位正交基$(e_1,e_2,e_3)$经过旋转变为了$(e_1^,e_2^,,e_3^, )$, 对于向量$\vec{a}$ :

	$$
	\begin{bmatrix}
		e_1^T & e_2^T & e_3^T
	\end{bmatrix}
	\begin{bmatrix}
		a_1 \\ a_2 \\ a_3
	\end{bmatrix}=
	\begin{bmatrix}
		e_1^, & e_2^, & e_3^,
	\end{bmatrix}
	\begin{bmatrix}
		a_1^, \\ a_2^, \\ a_3^,
	\end{bmatrix}
	$$

	所以可得:

	$$
	\begin{bmatrix}
		a_1 & a_2 & a_3
	\end{bmatrix}=
	\begin{bmatrix}
		e_1^Te_1^, & e_1^Te_2^, & e_1^Te_3^, \\
		e_2^Te_1^, & e_2^Te_2^, & e_2^Te_3^, \\
		e_3^Te_1^, & e_3^Te_2^, & e_3^Te_3^, \\
	\end{bmatrix}
	\begin{bmatrix}
		a_1^, & a_2^, & a_2^, 
	\end{bmatrix}
	= Ra^,
	$$

	$R$ 是一个旋转矩阵, 旋转矩阵的性质:

	$$
	旋转矩阵R \begin{cases}
		R是正交矩阵 
		\begin{cases}
			R^{-1} = R^T \\
			R^TR = I
		\end{cases}
		 \\
		R的行列式为1
	\end{cases}
	$$

	将n维空间的旋转矩阵表示为 $SO(n)$

2. 平移:

	将旋转和平移合并到一起:

	$$
	a^, = Ra +t
	$$

	$t$表示平移向量

### 变化矩阵与齐次坐标系

如果进行了两次线性变换:

$$
b=R_1a+t_1, \quad c=R_2b+t_2
$$

那么从a到c的变换为:

$$
c=R_2(R_1a+t_1)+t_2
$$

但是这样的变换太复杂,我们引入齐次坐标和变换矩阵的重写式:

$$
\begin{bmatrix}
	a^, \\1
\end{bmatrix}=
\begin{bmatrix}
	R & t \\
	0 & 1
\end{bmatrix}
\begin{bmatrix}
	a \\ 1
\end{bmatrix}
= T
\begin{bmatrix}
	a \\ 1
\end{bmatrix}
$$

我们在一个三维向量的末尾加1,将其变为4维向量, 称其为 **齐次坐标** . 我们我们将旋转和平移写在了一个矩阵里,使得这个关系变成了线性关系.

我们用 $\tilde{a}$ 表示$a$ 的齐次坐标.

>齐次坐标: 乘以任意非零常数后任表示同一坐标.

转化为非齐次坐标,就是乘以一个非零常数将坐标的最后以为变为1

那么;坐标a 到坐标 c的转变为:

$$
\tilde{c} =T_2T_1\tilde{a}
$$

在后面默认用 $b=Ta$ 表示其次方程.

关于上述的转换矩阵T, 又称为 `特殊欧式群`

$$
SE(3) = 
\left\{
	T =
	\begin{bmatrix}
		R & t \\
		0^T & 1
	\end{bmatrix}
	\in R^{4 \times 4} | R \in SO(3), t\in R^{3\times 3}
\right\}
$$

>一个欧式运动由`旋转`和`平移`组成.

$$
T^{-1} =
\begin{bmatrix}
	R^T & -R^Tt \\
	0^T & 1
\end{bmatrix}
$$

> 为了方便,在后面使用`Ta`表示齐次坐标,使用`Ra`表示非齐次坐标.

## 实践:Eigen

该部分有两个内容:

- 如何使用Eigen来表示矩阵,向量
- 旋转矩阵与变换矩阵的计算

安装Eigen:

```bash
sudo apt-get install libeigen3-dev
```

对eigen的实践使用:
转`code/第三讲`文件夹

## 旋转向量和欧拉角

### 旋转向量

回顾:

- SO(n)特殊正交群: $SO(n) = \{R \in R^{n \times n} | RR^T =I, det(R)=1 \}$ . R为旋转矩阵.
- SE(n)特殊欧式群: $
SE(3) = 
\left\{
	T =
	\begin{bmatrix}
		R & t \\
		0^T & 1
	\end{bmatrix}
	\in R^{4 \times 4} | R \in SO(3), t\in R^{3\times 3}
\right\}
$ ,T 为变换矩阵.

存在的问题:

1. SO(3)的旋转矩阵R有9个量,SE(3)的变换矩阵有16个量表达了6个自由度的变换. 是否有更加紧凑的表达方式呢?
2. R,T矩阵必须是正交矩阵,且行列式为1. 这些约束使得在估计或优化矩阵时变得困难.

因此,需要一种更紧凑的方法来描述旋转和平移.

`旋转向量`: 其方向与旋转轴一致, 而长度等于旋转角. 这种表示方法只需要一个三维向量就可以描述旋转.

一次变换可用三维向量旋转,3维向量平移,合并为一个6维向量表示.

>实际上`旋转向量`就是`李代数`

`罗德里的公式`(Rodrigues's Formula)表明:

$$
R = \cos{\theta I} +(1-\cos{\theta})nn^T + \sin{\theta } n^{\wedge}
$$

>符号 ^ 表示向量的反对称符号.

反之,可以计算旋转矩阵到旋转向量的转换. 对于转角 $\theta$ :

$$
\begin{aligned}
	tr(R) & = \cos\theta tr(I) + (1-\cos\theta) tr(nn^T) + \sin{\theta} tr(n^{\wedge})\\
	& = 3\cos\theta +(1-\cos\theta) \\
	& = 1+2\cos\theta
\end{aligned}
$$


因此:

$$
\theta=\arccos(\frac{tr(R)-1}{2})
$$

由于旋转轴上的向量在旋转后不发生变化,所以关于转轴`n`:

$$
Rn = n \quad \Rightarrow \quad (R-1)n =0
$$
所以,转轴n是矩阵R特征值1对应的特征向量.

### 欧拉角

将旋转分解为$XYZ$轴上的旋转. 著名的旋转顺序为$ZYX$,它被称为$rpy$旋转,使用$[r,p,y]^T$向量表示.

欧拉角的重大缺陷是会碰到著名的万向锁问题: 在俯仰角(绕Y轴旋转)为$\pm90^\circ$时,第一次旋转和第三次旋转将使用同一个轴,使得系统丢失了一个自由度. 这被称为`奇异性问题`.

欧拉角不适用与插值与迭代,往往只用于人机交互中, 本书中很少使用欧拉角表示姿态,也不会在滤波和优化中使用欧拉角表示旋转.

## 四元数

### 四元数的定义

